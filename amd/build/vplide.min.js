function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}define ("mod_vpl/vplide",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidefile","mod_vpl/vplidebutton","mod_vpl/vplterminal","mod_vpl/vplvnc"],function(t,e,l,n,a,o,d){var s,r=function(e,c){var C=this,V,k,S,I,N,H,P=c.minfiles||0,W=c.maxfiles||0,O=c.restrictededitor||c.example,R=c.example,E=!1,j=l.scrollBarWidth(),D=l.str,B=t("#"+e);t("head").append("<meta name=\"viewport\" content=\"initial-scale=1\">").append("<meta name=\"viewport\" width=\"device-width\">").append("<link rel=\"stylesheet\" href=\"../editor/VPLIDE.css\"/>");if("object"!=_typeof(B)){throw new Error("VPL: constructor tag_id not found")}var q={new:!0,rename:!0,delete:!0,save:!0,run:!0,edit:!0,debug:!0,evaluate:!0,import:!0,resetfiles:!0,sort:!0,multidelete:!0,acetheme:!0,console:!0,comments:!0};if("undefined"==typeof c.loadajaxurl){c.loadajaxurl=c.ajaxurl}(function(){var e=P<W;c.new=e;c.rename=e;c.delete=e;c.comments=c.comments&&!c.example;c.acetheme=!0})();c.sort=2<=W-P;c.multidelete=c.sort;c.import=!O;var K=function(e){if(!q[e]){return!0}return c[e]};c.console=K("run")||K("debug");if("undefined"==typeof c.fontSize){c.fontSize=12}c.fontSize=parseInt(c.fontSize);function p(i){if(O){i.originalEvent.dataTransfer.dropEffect="none"}else{i.originalEvent.dataTransfer.dropEffect="copy"}i.preventDefault()}function u(i){if(O){i.stopImmediatePropagation();return!1}var e=i.originalEvent.dataTransfer;if(0<e.files.length){l.readSelectedFiles(e.files,function(e){return V.addFile(e,!0,N,I)},function(){V.fileListVisibleIfNeeded()});i.stopImmediatePropagation();return!1}return!1}B.on("drop",u);B.on("dragover",p);function g(i){if(O){i.stopPropagation();return!1}return!0}var U=t("#vpl_menu"),G=new a(U,K),X=t("#vpl_tr"),r=t("#vpl_filelist"),Y=t("#vpl_filelist_header"),Q=t("#vpl_filelist_content"),J=t("#vpl_tabs_ul"),Z=t("#vpl_tabs"),$=t("#vpl_results"),ee=t("#vpl_results_accordion");r.vplMinWidth=80;$.vplMinWidth=100;function m(e,i){if("newHeader"in i){if(i.newHeader.hasClass("vpl_ide_accordion_t_grade")){return!1}}return!0}function h(){var a=t("#vpl_tabs_ul");t("#vpl_tabs").tabs();var o=t("#vpl_tabs").tabs("widget"),d=[],m=[],h=!0,f=this;(function(){var e;f.setVersion=function(i){e=i};f.getVersion=function(){return e}})();this.updateFileList=function(){f.generateFileList()};this.fileNameExists=function(e){for(var t=e.toLowerCase(),l=0;l<d.length;l++){if(d[l].getFileName().toLowerCase()==t){return l}}return-1};function e(e){for(var t=e.toLowerCase()+"/",l=0,n;l<d.length;l++){n=d[l].getFileName().toLowerCase()+"/";if(0===n.indexOf(t)||0===t.indexOf(n)){return!0}}return!1}function i(e,t){if(l.isBlockly(e)){return!1}if(l.isBlockly(t)){for(var n=0;n<d.length;n++){if(l.isBlockly(d[n].getFileName())){return!0}}}return!1}this.restrictedPaste=g;this.dropHandler=u;this.dragoverHandler=p;this.readOnly=R;this.restrictedEdit=O;this.adjustTabsTitles=k;this.minNumberOfFiles=P;this.scrollBarWidth=j;var v="";this.setClipboard=function(e){v=e};this.getClipboard=function(){return v};this.getTabPos=function(e){for(var t=0;t<m.length;t++){if(m[t]==e){return t}}return m.length};this.getTheme=function(){return c.theme};this.setTheme=function(e){c.theme=e;for(var t=0;t<d.length;t++){d[t].setTheme(e)}};this.addTab=function(e){a.append("<li id=\"vpl_tab_name"+e+"\">"+("<a href=\"#vpl_file"+e+"\"></a>")+"</li>");o.append("<div id=\"vpl_file"+e+"\" class=\"vpl_ide_file\"></div>")};this.removeTab=function(e){a.find("#vpl_tab_name"+e).remove();o.find("#vpl_file"+e).remove()};this.open=function(e){var i;if("object"==_typeof(e)){i=e}else{i=d[e]}if(i.isOpen()){return}var t=i.getId();f.addTab(t);m.push(i);G.setGetkeys(i.open());o.tabs("refresh");k(!1);l.delay("updateFileList",f.updateFileList);l.delay("updateMenu",N)};this.close=function(e){if(!e.isOpen()){return}var i,t=e.getId();e.close();f.removeTab(t);var n=f.getTabPos(e);m.splice(n,1);o.tabs("refresh");k(!1);f.fileListVisible(!0);l.delay("updateFileList",f.updateFileList);l.delay("adjustTabsTitles",k,!1);if(m.length>n){i=f.getFilePosById(m[n].getId());f.gotoFile(i,"c");return}if(0<n){i=f.getFilePosById(m[n-1].getId());f.gotoFile(i,"c")}};this.isClosed=function(e){return!d[e].isOpen()};this.fileListVisible=function(e){if(e===r.vplVisible){return}if(e){l.delay("fileListVisible",function(){r.vplVisible=!0;f.updateFileList();r.show();S()})}else{l.delay("fileListVisible",function(){r.vplVisible=!1;r.hide();S()})}};this.isFileListVisible=function(){return r.vplVisible};this.fileListVisibleIfNeeded=function(){if(this.isFileListVisible()){return}for(var e=0;e<d.length;e++){if(!d[e].isOpen()){this.fileListVisible(!0);return}}};this.setFontSize=function(e){c.fontSize=e;for(var t=0;t<d.length;t++){d[t].setFontSize(e)}Te.setFontSize(e)};this.getFontSize=function(){return c.fontSize};this.addFile=function(t,a,o,r){if("string"!=typeof t.name||!l.validPath(t.name)){r(D("incorrect_file_name")+" ("+t.name+")");return!1}if(!0!==a){a=!1}var c=this.fileNameExists(t.name);if(-1!=c){if(a){d[c].setContent(t.contents);f.setModified();o();l.delay("updateFileList",f.updateFileList);return t}else{r(D("filenotadded",t.name));return!1}}if(e(t.name)||i("",t.name)){r(D("filenotadded",t.name));return!1}if(d.length>=W){r(D("maxfilesexceeded")+" ("+W+")");return!1}var p=l.getUniqueId(),u=new n(p,t.name,t.contents,this,s);if(1==t.encoding){u.extendToBinary()}else{if(l.isBlockly(t.name)){u.extendToBlockly()}else{u.extendToCodeEditor()}}u.setFileName(t.name);d.push(u);f.setModified();if(5<d.length){f.fileListVisible(!0)}o();return u};this.renameFile=function(t,n,a){var o=this.fileNameExists(t);try{if(-1==o){throw new Error("Internal error: File name not found")}if(o<P){throw new Error("Internal error: Renaming requested filename")}if(d[o].getFileName()==n){return!0}if(!l.validPath(n)||e(n)||i(t,n)){throw D("incorrect_file_name")}if(l.isBinary(t)&&l.fileExtension(t)!=l.fileExtension(n)){throw D("incorrect_file_name")}if(l.isBlockly(t)!=l.isBlockly(n)){throw D("incorrect_file_name")}d[o].setFileName(n)}catch(i){a(D("filenotrenamed",n)+": "+i);return!1}f.setModified();k(!1);l.delay("updateFileList",f.updateFileList);return!0};this.deleteFile=function(e,i,t){var n=this.fileNameExists(e);if(-1==n){t(D("filenotdeleted",e));return!1}if(n<P){t(D("filenotdeleted",e));return!1}f.setModified();f.close(d[n]);d.splice(n,1);l.delay("updateFileList",f.updateFileList);return!0};this.currentFile=function(){var e=o.tabs("option","active");if(e in m){var i=m[e];if(0===arguments.length){return i}var t=arguments[0];if("function"==typeof i[t]){var l=i[t],n=Array.prototype.slice(arguments);n.shift();return l.apply(i,n)}}return!1};this.currentPos=function(){return o.tabs("option","active")};this.getFileTab=function(e){for(var t=0;t<m.length;t++){if(m[t].getId()==e){return t}}return-1};this.getFilePosById=function(e){for(var t=0;t<d.length;t++){if(d[t].getId()==e){return t}}return-1};this.gotoFile=function(e,i){var t=d[e];f.open(t);o.tabs("option","active",f.getFileTab(t.getId()));if("c"!==i){t.gotoLine(parseInt(i,10))}t.focus()};this.gotoFileLink=function(e){var i=t(e),l=i.data("file"),n=-1;if(""<l){n=this.fileNameExists(l)}else{n=f.getFilePosById(i.data("fileid"))}if(0<=n){var a=i.data("line");if("undefined"==typeof a){a="c"}f.gotoFile(n,a);return!0}return!1};this.getFilesToSave=function(){for(var e=[],t=0,l;t<d.length;t++){l={};l.name=d[t].getFileName();l.contents=d[t].getContent();l.encoding=d[t].isBinary()?1:0;e.push(l)}return e};this.resetModified=function(){h=!1;for(var e=0;e<d.length;e++){d[e].resetModified()}l.delay("updateMenu",N);l.delay("updateFileList",f.updateFileList)};this.setModified=function(){h=!0;l.delay("updateFileList",f.updateFileList);l.delay("updateMenu",N)};this.isModified=function(){return h};this.length=function(){return d.length};this.clearAnnotations=function(){for(var e=0;e<d.length;e++){d[e].clearAnnotations()}};this.getFile=function(e){return d[e]};this.getFiles=function(){return d};this.getDirectoryStructure=function(){var t={isDir:!0,content:{}};function e(e){var i=d[e],l=i.getFileName(),n=l.split("/"),a=t;for(var o in n){if(n.hasOwnProperty(o)){var s=n[o];if(o==n.length-1){a.content[s]={isDir:!1,content:i,pos:e}}else{if(!a.content[s]){a.content[s]={isDir:!0,content:{}}}a=a.content[s]}}}}for(var l in d){if(d.hasOwnProperty(l)){e(l)}}return t};this.generateFileList=function(){if(!f.isFileListVisible()){return}function e(i,t,n){for(var a in i.content){if(i.content.hasOwnProperty(a)){var o=i.content[a];if(o.isDir){n.push(t+l.iconFolder()+l.sanitizeText(a));e(o,t+"<span class=\"vpl_ide_dirindent\"></span>",n)}else{var d=o.content,s=l.sanitizeText(a),r=l.sanitizeText(d.getFileName());if(d.isOpen()){s="<b>"+s+"</b>"}var c="href=\"#\" data-fileid=\""+d.getId()+"\" title=\""+r+"\"",p="<a "+c+">"+s+"</a>";if(d.isModified()){p=l.iconModified()+p}if(o.pos<P){p=p+l.iconRequired()}n.push(t+p)}}}}var t=f.getDirectoryStructure(),n=[],a="";e(t,"",n);for(var o=0;o<n.length;o++){a+=n[o]+"<br>"}Q.html("<div>"+a+"</div>")};a.on("click","span.vpl_ide_closeicon",function(){V.close(V.currentFile())});a.on("dblclick","span.vpl_ide_closeicon",G.getAction("delete"));a.on("dblclick","a",G.getAction("rename"));Q.on("dblclick","a",G.getAction("rename"))}this.updateEvaluationNumber=function(e){if("undefined"!=typeof e.nevaluations){var i=e.nevaluations;if("undefined"!=typeof e.reductionbyevaluation&&""<e.reductionbyevaluation&&0!=e.reductionbyevaluation){if(0!=e.freeevaluations){i=i+"/"+e.freeevaluations}i=i+" -"+e.reductionbyevaluation}G.setExtracontent("evaluate",i)}};this.lastResult=null;this.getTerminal=function(){return Te};this.setResultGrade=function(e,i){var t="vpl_ide_accordion_t_grade",l="vpl_ide_accordion_c_grade";if(0==ee.find("."+l).length){ee.append("<div class=\""+t+"\"></div>");ee.append("<div class=\""+l+"\"></div>")}if("undefined"==typeof i){return 0<ee.find("h4."+t).length}var n=ee.find("."+t);if(""<e){n.replaceWith("<h4 class=\""+t+"\">"+e+"</h4>");return!0}else{n.replaceWith("<div class=\""+t+"\"></div>");return!1}};this.setResultTab=function(e,i,l){var n="vpl_ide_accordion_t_"+e,a="vpl_ide_accordion_c_"+e;if(0==ee.find("."+a).length){ee.append("<div class=\""+n+"\"></div>");ee.append("<div class=\""+a+"\"></div>")}if("undefined"==typeof l){return 0<ee.find("h4."+n).length}var o=ee.find("."+n),d=ee.find("."+a),s=t("<div>"+i+"</div>");s.find("h4").replaceWith(function(){return t("<h5>").append(t(this).contents())});if(d.html()==s.html()){return""<i}if(""<i){o.replaceWith("<h4 class=\""+n+"\">"+D(e)+"</h4>");d.replaceWith("<div class=\"ui-widget "+a+"\">"+s.html()+"</div>");return!0}else{o.replaceWith("<div class=\""+n+"\"></div>");d.replaceWith("<div class=\""+a+"\"></div>");return!1}};this.setResult=function(e,t){C.updateEvaluationNumber(e);var n=V.getFiles(),a=[],o;for(o=0;o<n.length;o++){a[o]=n[o].getFileName();n[o].clearAnnotations()}var d=!1,s,r=l.sanitizeText(e.grade),c,p;c=C.setResultGrade(r,e.grade);d=d||c;s=C.setResultTab("variables",e.variables,e.variables);d=d||s;p=l.processResult(e.compilation,a,n,!0,!1);s=C.setResultTab("compilation",p,e.compilation);d=d||s;p=l.processResult(e.evaluation,a,n,!1,!1);s=C.setResultTab("comments",p,e.evaluation);d=d||s;p=l.sanitizeText(e.execution);s=C.setResultTab("execution",p,e.execution);d=d||s;s=C.setResultTab("description",window.VPLDescription,window.VPLDescription);if(s&&"object"==("undefined"==typeof MathJax?"undefined":_typeof(MathJax))){var u=ee.find(".vpl_ide_accordion_c_description")[0];MathJax.Hub.Queue(["Typeset",MathJax.Hub,u])}d=d||s;if(d){$.show();$.vplVisible=!0;ee.accordion("refresh");ee.accordion("option","active",c?1:0);for(o=0;o<n.length;o++){for(var g=n[o].getAnnotations(),m=0;m<g.length;m++){if(t||"error"==g[m].type){V.gotoFile(o,g[m].row+1);break}}}}else{$.hide();$.vplVisible=!1}l.delay("autoResizeTab",S)};ee.accordion({heightStyle:"fill",header:"h4",animate:!1,beforeActivate:m});$.width(2*$.vplMinWidth);ee.on("click","a",function(e){if(V.gotoFileLink(e.currentTarget)){e.preventDefault()}});$.vplVisible=!1;$.hide();r.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");Y.text(D("filelist"));Y.html(l.iconFolder()+Y.html());Y.addClass("ui-widget-header ui-button-text-only ui-corner-all");Q.addClass("ui-widget ui-corner-all");r.width(2*r.vplMinWidth);r.on("click","a",function(e){e.preventDefault();V.gotoFileLink(e.currentTarget)});r.vplVisible=!1;r.hide();var ie=!1;function f(){if(!1===ie){ie=(Z.outerWidth(!0)-Z.width())/2}return ie}function v(i,e){var t=e.position.left-e.originalPosition.left,l;if(0!=t){l=Z.width()+r.width()-r.vplMinWidth;Z.resizable("option","maxWidth",l);r.width(r.vplOriginalWidth+t)}else{l=Z.width()+$.width()-$.vplMinWidth;Z.resizable("option","maxWidth",l);var n=e.size.width-e.originalSize.width;$.width($.vplOriginalWidth-n)}V.currentFile("adjustSize")}var te={containment:"parent",resize:v,start:function start(){t(window).off("resize",S);Z.resizable("option","minWidth",100);if($.vplVisible){$.vplOriginalWidth=$.width()}if(r.vplVisible){r.vplOriginalWidth=r.width()}},stop:function stop(i,e){v(i,e);Z.resizable("option","maxWidth",1e5);Z.resizable("option","minWidth",0);S();t(window).on("resize",S)},handles:""};Z.resizable(te);function _(){var e=0;e+=r.vplVisible?1:0;e+=$.vplVisible?2:0;Z.resizable("destroy");te.handles=["e","w","e","e, w"][e];te.disable=0===e;Z.resizable(te)}function b(){var e=t(window).outerHeight();e-=U.offset().top+U.height()+(E?f():20);if(150>e){e=150}X.height(e);var i=e-3*f();Z.height(i);if($.vplVisible){$.height(i+f());ee.accordion("refresh")}if(r.vplVisible){Q.height(i-(Y.outerHeight()+f()));r.height(i)}}k=function(e){var i=Z.width(),l=0;J.width(1e5);var n=J.children("li:visible").last();if(n.length){var a=J.parent().scrollLeft();l=a+n.position().left+n.width()+ie;J.width(l);var o=V.currentFile();if(o&&e){var d=t(o.getTabNameId()),s=a+d.position().left;s-=(i-d.outerWidth())/2;if(0>s){s=0}J.parent().finish().animate({scrollLeft:s},"slow")}}if(l<i){J.width("")}};S=function(){var e=Z.width(),i=U.width(),t=!1;_();X.width(U.outerWidth());if(r.vplVisible){var l=r.outerWidth()+ie;e+=l;if(100<=l){i-=l;Z.css("left",l)}else{t=!0}}else{Z.css("left",0)}if($.vplVisible){var n=$.outerWidth()+ie;e+=n;i-=n;if(100>i){t=!0}}if(t){var a=U.width()/e,o=0;if(r.vplVisible){o=r.width()*a;r.width(o-ie);o+=ie;Z.css("left",o)}Z.width(Z.width()*a);if($.vplVisible){$.width(U.width()-(o+Z.width()+ie))}}else{Z.width(i)}k(!0);b();V.currentFile("adjustSize")};function F(){V.currentFile("focus")}var le=t.extend({},{close:F},l.dialogbaseOptions);function T(e,i){return l.showMessage(e,t.extend({},le,i))}I=function(e){return l.showErrorMessage(e,{close:F})};var ne=t("#vpl_ide_dialog_new");function w(e){if(!("click"==e.type||"keypress"==e.type&&13==e.keyCode)){return!0}ne.dialog("close");var i={name:t("#vpl_ide_input_newfilename").val(),contents:"",encoding:0},l=V.addFile(i,!1,N,I);if(l){V.open(l);Z.tabs("option","active",V.getTabPos(l));l.focus();return!0}return!1}var ae={};ae[D("ok")]=w;ae[D("cancel")]=function(){t(this).dialog("close")};ne.find("input").on("keypress",w);ne.dialog(t.extend({},le,{title:D("create_new_file"),buttons:ae}));l.setDialogTitleIcon(ne,"new");var oe=t("#vpl_ide_dialog_rename");function y(e){if(!("click"==e.type||"keypress"==e.type&&13==e.keyCode)){return}oe.dialog("close");V.renameFile(V.currentFile("getFileName"),t("#vpl_ide_input_renamefilename").val(),I);e.preventDefault()}oe.find("input").on("keypress",y);ae[D("ok")]=y;oe.dialog(t.extend({},le,{open:function open(){t("#vpl_ide_input_renamefilename").val(V.currentFile("getFileName"))},title:D("rename_file"),buttons:ae}));l.setDialogTitleIcon(oe,"rename");ae[D("ok")]=function(){t(this).dialog("close")};var de=t("#vpl_ide_dialog_comments");de.dialog(t.extend({},le,{title:D("comments"),width:"40em",buttons:ae}));l.setDialogTitleIcon(de,"comments");t("#vpl_ide_input_comments").width("30em");var se=t("#vpl_ide_dialog_about"),re={};re[D("ok")]=function(){t(this).dialog("close")};var ce=t("#vpl_ide_dialog_shortcuts");ce.dialog(t.extend({},le,{open:function open(){var e=G.getShortcuts(V.currentFile("getEditor"));t("#vpl_ide_dialog_shortcuts").html(e)},title:D("shortcuts"),width:400,height:300,buttons:re}));ce.dialog("option","height",300);l.setDialogTitleIcon(ce,"shortcuts");re[D("shortcuts")]=function(){t(this).dialog("close");ce.dialog("open")};se.dialog(t.extend({},le,{open:function open(){var e=G.getShortcuts(V.currentFile("getEditor"));se.next().find("button").filter(function(){return t(this).text()==D("shortcuts")}).button(""!=e?"enable":"disable")},title:D("about"),width:400,height:300,buttons:re}));se.dialog("option","height",300);l.setDialogTitleIcon(se,"about");var pe=t("#vpl_ide_dialog_sort"),ue={};ue[D("ok")]=function(){var e=V.getFiles(),l=[],n=0,a=t("#vpl_sort_list li");if(a.length!=e.length){return}a.each(function(){var i=parseInt(this.id.replace(/[^\d]*/,""));l.push(e[i])});for(n=0;n<a.length;n++){e[n]=l[n]}V.setModified();t(this).dialog("close")};ue[D("cancel")]=function(){t(this).dialog("close")};pe.dialog(t.extend({},le,{title:D("sort"),buttons:ue,open:function open(){var e=t("#vpl_sort_list");e.html("");for(var l=V.getFiles(),n=0,a;n<l.length;n++){a=t("<li id=\"vpl_fsort_"+n+"\"class=\"ui-widget-content\"></li>");if(n<P){a.addClass("ui-state-disabled")}a.text(n+1+"-"+l[n].getFileName());e.append(a)}e.sortable({items:"li:not(.ui-state-disabled)",placeholder:"ui-state-highlight",start:function start(e,i){i.item.addClass("ui-state-highlight")},stop:function stop(e,i){i.item.removeClass("ui-state-highlight")}});e.disableSelection()},maxHeight:400}));l.setDialogTitleIcon(pe,"sort");var ge=t("#vpl_ide_dialog_multidelete"),me={};me[D("selectall")]=function(){t(this).find("input").prop("checked",!0)};me[D("deselectall")]=function(){t(this).find("input").prop("checked",!1)};me[D("deleteselected")]=function(){var e=V.getFiles(),n=[],a=t("#vpl_multidelete_list label");a.each(function(){var i=t(this);if(i.find("input").prop("checked")){var l=i.data("fileid");n.push(e[l].getFileName())}});for(var o=0;o<n.length;o++){V.deleteFile(n[o],!1,I)}l.delay("updateMenu",N);l.delay("updateFileList",V.updateFileList);t(this).dialog("close")};me[D("cancel")]=function(){t(this).dialog("close")};ge.dialog(t.extend({},le,{title:D("multidelete"),buttons:me,open:function open(){var e=t("#vpl_multidelete_list");e.html("");for(var n=V.getFiles(),a=P;a<n.length;a++){var o=l.sanitizeText(n[a].getFileName()),d=t("<label><input type=\"checkbox\"> "+o+"</label>");d.data("fileid",a);e.append(d);e.append("<br>")}e.find("label").button()},maxHeight:400,maxWidth:400}));l.setDialogTitleIcon(ge,"multidelete");var he=t("#vpl_ide_dialog_fontsize"),fe=t("#vpl_ide_dialog_fontsize .vpl_fontsize_slider"),ve={};ve[D("ok")]=function(){var e=fe.slider("value");V.setFontSize(e);t(this).dialog("close");t.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({fontSize:e}),contentType:"application/json; charset=utf-8",dataType:"json"})};ve[D("cancel")]=function(){V.setFontSize(fe.data("vpl_fontsize"));t(this).dialog("close")};ve[D("reset")]=function(){fe.slider("value",12)};he.dialog(t.extend({},le,{title:D("fontsize"),buttons:ve,open:function open(){fe.data("vpl_fontsize",V.getFontSize());fe.slider("value",V.getFontSize())}}));fe.slider({min:1,max:48,change:function change(){var e=fe.slider("value");V.setFontSize(e);he.find(".vpl_fontsize_slider_value").text(e)}});l.setDialogTitleIcon(he,"fontsize");var _e=t("#vpl_ide_dialog_acetheme"),be=t("#vpl_ide_dialog_acetheme select"),Fe={};Fe[D("ok")]=function(){V.setTheme(be.val());t(this).dialog("close");l.setUserPreferences({aceTheme:be.val()})};Fe[D("cancel")]=function(){V.setTheme(be.data("acetheme"));t(this).dialog("close")};Fe[D("reset")]=function(){be.val(be.data("acetheme"));V.setTheme(be.val())};_e.dialog(t.extend({},le,{title:D("theme"),buttons:Fe,modal:!1,open:function open(){be.data("acetheme",V.getTheme());be.val(V.getTheme())}}));be.on("change",function(){V.setTheme(be.val())});l.setDialogTitleIcon(_e,"theme");var Te=new o("vpl_dialog_terminal","vpl_terminal",D),we=new d("vpl_dialog_vnc",D),ye=Te,xe=t("#vpl_ide_input_file");xe.on("change",function fileSelectHandler(){l.readSelectedFiles(this.files,function(e){return V.addFile(e,!0,N,I)},function(){V.fileListVisibleIfNeeded()})});G.add({name:"filelist",originalAction:function originalAction(){V.fileListVisible(!V.isFileListVisible());l.delay("updateMenu",N);l.delay("autoResizeTab",S);l.delay("updateFileList",V.updateFileList)},bindKey:{win:"Ctrl-L",mac:"Ctrl-L"}});G.add({name:"new",originalAction:function originalAction(){if(V.length()<W){ne.dialog("open")}},bindKey:{win:"Alt-N",mac:"Option-N"}});G.add({name:"rename",originalAction:function originalAction(){var e=V.currentFile();if(e&&V.getFilePosById(e.getId())>=P){oe.dialog("open")}},bindKey:{win:"Ctrl-R",mac:"Ctrl-R"}});G.add({name:"delete",originalAction:function originalAction(){var e=V.currentFile();if(!e){return}var i=e.getFileName(),t=D("delete_file_fq",i);T(t,{ok:function ok(){V.deleteFile(i,I)},title:D("delete_file_q"),icon:"trash"})},bindKey:{win:"Ctrl-D",mac:"Ctrl-D"}});G.add({name:"close",originalAction:function originalAction(){var e=V.currentFile();if(!e){return}V.close(e)},bindKey:{win:"Alt-W",mac:"Option-W"}});G.add({name:"import",originalAction:function originalAction(){xe.val("");xe.trigger("click")},bindKey:{win:"Ctrl-I",mac:"Ctrl-I"}});G.add({name:"sort",originalAction:function originalAction(){pe.dialog("open")},bindKey:{win:"Ctrl-O",mac:"Ctrl-O"}});G.add({name:"multidelete",originalAction:function originalAction(){ge.dialog("open")}});G.add({name:"fontsize",originalAction:function originalAction(){he.dialog("open")}});G.add({name:"theme",originalAction:function originalAction(){_e.dialog("open")}});G.add({name:"print",originalAction:function originalAction(){window.print()},bindKey:{win:"Alt-P",mac:"Command-P"}});G.add({name:"undo",originalAction:function originalAction(){V.currentFile("undo")}});G.add({name:"redo",originalAction:function originalAction(){V.currentFile("redo")}});G.add({name:"select_all",editorName:"selectall",originalAction:function originalAction(){V.currentFile("selectAll")}});G.add({name:"find",originalAction:function originalAction(){V.currentFile("find")}});G.add({name:"find_replace",editorName:"replace",originalAction:function originalAction(){V.currentFile("replace")}});G.add({name:"next",editorName:"findnext",originalAction:function originalAction(){V.currentFile("next")}});G.add({name:"fullscreen",originalAction:function originalAction(){var e="header, nav, footer, aside, .dropdown, #page-header, div.navbar, #nav-drawer";e+=", div.tabtree, #dock, .breadcrumb-nav, .moodle-actionmenu";if(E){B.removeClass("vpl_ide_root_fullscreen");t("body").removeClass("vpl_body_fullscreen");G.setText("fullscreen","fullscreen");t(e).show();t("#vpl_ide_user").hide();E=!1}else{t("body").addClass("vpl_body_fullscreen").scrollTop(0);t(e).hide();B.addClass("vpl_ide_root_fullscreen");G.setText("fullscreen","regularscreen");if(c.username){t("#vpl_ide_user").show()}E=!0}F();setTimeout(S,10)},bindKey:{win:"Alt-F",mac:"Ctrl-F"}});G.add({name:"download",originalAction:function originalAction(){window.location=c.download}});function x(){l.requestAction("resetfiles","",{},c.ajaxurl).done(function(e){var i=e.files;for(var t in i){if(i.hasOwnProperty(t)){V.addFile(i[t],!0,l.doNothing,I)}}V.fileListVisibleIfNeeded();l.delay("updateMenu",N)}).fail(I)}G.add({name:"resetfiles",originalAction:function originalAction(){T(D("sureresetfiles"),{title:D("resetfiles"),ok:x,icon:"resetfiles"})}});G.add({name:"save",originalAction:function originalAction(){var i={files:V.getFilesToSave(),comments:t("#vpl_ide_input_comments").val(),version:V.getVersion()};if(JSON.stringify(i).length>c.postMaxSize){I(D("maxpostsizeexceeded"));return}function e(){l.requestAction("save","saving",i,c.ajaxurl).done(function(t){if(t.requestsconfirmation){T(t.question,{title:D("saving"),icon:"alert",yes:function yes(){i.version=t.version;e()}})}else{V.resetModified();V.setVersion(t.version);G.setTimeLeft(t);l.delay("updateMenu",N);if(l.monitorRunning()){l.requestAction("update","updating",i,c.ajaxurl)}}}).fail(I)}e()},bindKey:{win:"Ctrl-S",mac:"Command-S"}});function L(e,i,t){if(!t){t={}}if(!ye.isConnected()){l.requestAction(e,"",t,c.ajaxurl).done(function(t){l.webSocketMonitor(t,e,i,H)}).fail(I)}}function M(){L("run","running",{XGEOMETRY:we.getCanvasSize()})}G.add({name:"run",originalAction:function originalAction(){H.setLastAction(M);M()},bindKey:{win:"Ctrl-F11",mac:"Command-U"}});function A(){L("debug","debugging",{XGEOMETRY:we.getCanvasSize()})}G.add({name:"debug",originalAction:function originalAction(){H.setLastAction(A);A()},bindKey:{win:"Alt-F11",mac:"Option-U"}});function z(){L("evaluate","evaluating")}G.add({name:"evaluate",originalAction:function originalAction(){H.setLastAction(z);z()},bindKey:{win:"Shift-F11",mac:"Command-Option-U"}});G.add({name:"comments",originalAction:function originalAction(){de.dialog("open")}});G.add({name:"console",originalAction:function originalAction(){if(ye.isOpen()){ye.close()}else{ye.show()}}});G.add({name:"user"});G.add({name:"about",originalAction:function originalAction(){se.dialog("open")}});G.add({name:"timeleft",originalAction:function originalAction(){G.toggleTimeLeft()}});G.add({name:"more",originalAction:function originalAction(){var e=t("#vpl_ide_menuextra");if(e.is(":visible")){G.setText("more","more",l.str("more"));e.hide()}else{G.setText("more","less",l.str("less"));e.show()}l.delay("updateMenu",N);l.delay("autoResizeTab",S)}});U.addClass("ui-widget-header ui-corner-all");var Le="";Le+=G.getHTML("more");Le+=G.getHTML("save");Le+="<span id='vpl_ide_mexecution'>";Le+=G.getHTML("run");Le+=G.getHTML("debug");Le+=G.getHTML("evaluate");Le+=G.getHTML("comments");Le+=G.getHTML("console");Le+="</span> ";Le+="<span id='vpl_ide_menuextra'>";Le+="<span id='vpl_ide_file'>";Le+=G.getHTML("filelist");Le+=G.getHTML("new");Le+=G.getHTML("rename");Le+=G.getHTML("delete");Le+=G.getHTML("import");Le+=G.getHTML("download");Le+=G.getHTML("resetfiles");Le+=G.getHTML("sort");Le+=G.getHTML("multidelete");Le+=G.getHTML("fontsize");Le+=G.getHTML("theme");Le+="</span> ";Le+="<span id='vpl_ide_edit'>";Le+=G.getHTML("undo");Le+=G.getHTML("redo");Le+=G.getHTML("select_all");Le+=G.getHTML("find");Le+=G.getHTML("find_replace");Le+=G.getHTML("next");Le+="</span> ";Le+="</span> ";Le+=G.getHTML("fullscreen")+" ";Le+=G.getHTML("about")+" ";Le+=G.getHTML("user")+" ";Le+=G.getHTML("timeleft");Le+="<div class=\"clearfix\"></div>";U.append(Le);t("#vpl_ide_more").button();t("#vpl_ide_save").button();t("#vpl_ide_menuextra").hide();t("#vpl_ide_file").controlgroup();t("#vpl_ide_edit").controlgroup();t("#vpl_ide_mexecution").controlgroup();t("#vpl_ide_fullscreen").button();t("#vpl_ide_acetheme").button();t("#vpl_ide_about").button();t("#vpl_ide_user").button().css("float","right").hide();t("#vpl_ide_timeleft").button().css("float","right").hide();t("#vpl_menu .ui-button").css("padding","6px");t("#vpl_menu .ui-button-text").css("padding","0");for(var Me=["filelist","more","fullscreen","about","resetfiles","download","comments","console","import","fontsize","timeleft"],Ae=0;Ae<Me.length;Ae++){G.enable(Me[Ae],!0)}G.setExtracontent("user",c.username);G.setTimeLeft(c);N=function(){var e,t=V.currentFile(),n=V.length();if(n){Z.show()}else{Z.hide()}if(V.isFileListVisible()){G.setText("filelist","filelistclose",l.str("filelist"))}else{G.setText("filelist","filelist",l.str("filelist"))}var a=V.isModified();G.enable("save",a);var o=l.monitorRunning();if(o){G.setText("run","running")}else{G.setText("run","run")}G.enable("run",!o&&(!a||c.example)&&K("run"));G.enable("debug",!o&&(!a||c.example)&&K("debug"));G.enable("evaluate",!o&&(!a||c.example)&&K("evaluate"));G.enable("download",!a);G.enable("new",n<W);G.enable("sort",1<n-P);G.enable("multidelete",1<n-P);G.enable("theme",!0);var d;if(!t||0===n){d=["rename","delete","undo","redo","select_all","find","find_replace","next"];for(e=0;e<d.length;e++){G.enable(d[e],!1)}return}var s=V.getFilePosById(t.getId());G.enable("rename",s>=P&&0!==n);G.enable("delete",s>=P&&0!==n);G.enable("undo",t.hasUndo());G.enable("redo",t.hasRedo());G.enable("select_all",t.hasSelectAll());G.enable("find",t.hasFind());G.enable("find_replace",t.hasFindReplace());G.enable("next",t.hasNext());l.delay("updateFileList",V.updateFileList)};H={open:N,close:N,getConsole:function getConsole(){return ye},setResult:C.setResult,ajaxurl:c.ajaxurl,run:function run(e,i,t){var n=/^([^:]*):?(.*)/i.exec(e),a=n[1];if("terminal"==a||"webterminal"==a){if(ye&&ye.isOpen()){ye.close()}ye=Te;Te.connect(i.executionURL,function(){t.close();F()})}else if("vnc"==a){if(ye&&ye.isOpen()){ye.close()}ye=we;we.connect(i.secure,i.server,i.portToUse,i.VNCpassword,i.executionPath,function(){t.close();F()})}else if("browser"==a){var o=(i.secure?"https":"http")+"://"+i.server+":"+i.portToUse+"/";o+=n[2]+"/httpPassthrough";var d="<a href=\""+o+"\" target=\"_blank\">";d+=l.str("open")+"</a>";var s={icon:"run",title:l.str("run")};T(d,s)}else{l.log("Type of run error "+e,!0)}},lastAction:!1,getLastAction:function getLastAction(){var e=this.lastAction;this.lastAction=!1;return e},setLastAction:function setLastAction(e){this.lastAction=e}};Z.on("tabsactivate",function(){V.currentFile("focus");l.delay("updateMenu",N);l.delay("autoResizeTab",S)});var ze=t(window);ze.on("resize",S);if(!c.example){ze.on("beforeunload",function(){if(V.isModified()){return D("changesNotSaved")}})}V=new h;S();(function(){var i=U.width();function e(){var e=U.width();if(i!=e){i=e;S()}}e();setInterval(e,1e3)})();V.resetModified();l.requestAction("load","loading",c,c.loadajaxurl).done(function(e){for(var n=!0,a=e.files,o=!1,d=0;d<a.length;d++){var s=a[d],p=V.addFile(s,!1,N,I);if(p){p.resetModified();if(d<P||5>=a.length){V.open(p)}else{o=!0}}else{n=!1}}Z.tabs("option","active",0);if(e.compilationexecution){C.setResult(e.compilationexecution,!1)}G.setTimeLeft(e);if(""<e.comments){t("#vpl_ide_input_comments").val(e.comments)}if(n){V.resetModified()}else{V.setModified()}if(0===V.length()&&0<W){G.getAction("new")()}else if(!c.saved){V.setModified()}V.setFontSize(c.fontSize);V.setVersion(e.version);V.fileListVisible(o);l.afterAll("AfterLoadFiles",function(){N();S();k(!0)})}).fail(I)};window.VPLIDE=r;return{init:function init(e,i){s=new r(e,i)}}});
//# sourceMappingURL=vplide.min.js.map
