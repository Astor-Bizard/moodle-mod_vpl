define ("mod_vpl/vplvnc",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplclipboard","core/log"],function(a,b,c,d,e){window.INCLUDE_URI="../editor/noVNC/include/";Util.load_scripts(["webutil.js","base64.js","websock.js","des.js","keysymdef.js","keyboard.js","input.js","display.js","jsunzip.js","rfb.js","keysym.js"]);return function VPLVNCClient(b,f){var q=this,r,s="",u="",v="",x=a("#"+b),y=a("#vplide"),z=a("#"+b+" canvas"),A=c.doNothing,B,C=!0,D,E=window.document.createElement("input");E.style.position="absolute";E.style.left="0px";E.style.top="-10000px";E.style.width="1em";E.style.height="1ex";E.style.opacity="0";E.style.backgroundColor="transparent";E.style.borderStyle="none";E.style.outlineStyle="none";E.autocapitalize="off";E.autocomplete="off";E.autocorrect="off";E.wrap="off";E.spellcheck="false";x.append(E);function g(){if(a(E).is(":focus")){E.blur()}else{E.focus()}}function h(){if(q.isConnected()){r.clipboardPasteFrom(B.getEntry2())}}function i(a,b){B.setEntry1(b)}function j(){B.show()}function k(){if(q.isConnected()){r.get_keyboard().set_focused(!0)}}function l(){if(q.isConnected()){r.get_keyboard().set_focused(!1)}}function m(){B.setEntry1(B.getEntry1());document.execCommand("copy")}var F=c.genIcon("copy","sw")+" "+f("copy"),G=c.genIcon("paste","sw")+" "+f("paste");B=new d("vpl_dialog_vnc_clipboard",F,m,G,h,l);z.on("click",function(a){if(a.target==z[0]){k()}else{l()}});this.displayResize=function(){if(q.isConnected()){var a=x.width(),b=x.height();q.setCanvasSize(a,b);r.get_display().viewportChange(0,0,a,b)}};function n(){var a=y.width(),b=y.height();if(x.width()>a){C=!0;x.dialog("option","width",a)}if(x.parent().height()>b){C=!0;x.dialog("option","height",b-x.prev().outerHeight())}}x.dialog({closeOnEscape:!1,autoOpen:!1,modal:!0,width:"auto",height:"auto",dialogClass:"vpl_ide vpl_vnc",create:function create(){D=c.setTitleBar(x,"vnc","graphic",["clipboard","keyboard"],[j,g])},dragStop:n,focus:k,open:n,beforeClose:function beforeClose(){if(C){var a=x.width(),b=x.height();C=!1;q.setCanvasSize(a,b)}},close:function close(){q.disconnect()},resizeStop:function resizeStop(){n();C=!0}});x.css("padding","1px");this.updateTitle=function(){var a=s;if(""!==u){a+=" ("+u+")"}D.text(f("console")+": "+a)};this.setTitle=function(a){s=a;this.updateTitle()};this.setMessage=function(a){u=a;this.updateTitle()};function o(a,b,c,d){v=b;switch(b){case"normal":q.setMessage("");q.setTitle(f("connected"));break;case"disconnect":case"disconnected":q.setTitle(f("connection_closed"));break;case"failed":q.setTitle(f("connection_fail"));e.log("VNC client: "+d);break;default:q.setMessage("");q.setTitle(f("connecting"));}}this.connect=function(c,d,e,f,g,h){B.setEntry1("");A=h;q.show();var j=a("#"+b+" canvas")[0];if(!r){r=new RFB({target:j,encrypt:c,repeaterID:"",true_color:!0,local_cursor:!0,shared:!1,view_only:!1,onUpdateState:o,onPasswordRequired:null,onClipboard:i});r.set_local_cursor(r.get_display().get_cursor_uri())}if(!e){e=c?443:80}r.connect(d,e,f,g)};this.isOpen=function(){return x.dialog("isOpen")};this.close=function(){x.dialog("close")};this.isConnected=function(){return r&&"disconnected"!=v};this.disconnect=function(){if(r&&"normal"==v){r.disconnect()}A();B.hide()};function p(a){if(100>a){a=100}return 2*Math.floor(a/2)}this.getCanvasSize=function(){return z.width()+"x"+z.height()};this.setCanvasSize=function(a,b){z.width(p(a));z.height(p(b))};this.show=function(){x.dialog("open");x.width("auto");x.height("auto")};q.setCanvasSize(a(window).width()-150,a(window).height()-150)}});
//# sourceMappingURL=vplvnc.min.js.map
